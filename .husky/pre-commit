#!/usr/bin/env bash
set -euo pipefail
# fail nếu có CRLF hoặc thiếu newline EOF
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(sh|bash|sql|ya?ml|env)$' || true)
[ -z "$FILES" ] && exit 0
FAIL=0
for f in $FILES; do
  [ -f "$f" ] || continue
  if grep -Iq $'\r' "$f"; then
    echo "ERROR: CRLF found in $f"
    FAIL=1
  fi
  if [ -n "$(tail -c1 "$f")" ]; then
    echo "ERROR: Missing final newline in $f"
    FAIL=1
  fi
done
[ $FAIL -eq 0 ] || exit 1
